<!--
  ~ Copyright  2021 LSD Information Technology (Pty) Ltd
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<div class="p-fluid p-md-5">
  <div class="p-field p-float-label">
    <p-dropdown [options]="['Value', 'Secret']" [(ngModel)]="type" name="environmentVariableType" required></p-dropdown>
    <label>Type</label>
  </div>

  <div class="p-field p-float-label">
    <input pInputText id="newEnvironmentVariableKey" [(ngModel)]="key" name="newEnvironmentVariableKey">
    <label for="newEnvironmentVariableKey">Variable</label>
  </div>
  <div *ngIf="type === 'Value'" class="p-field p-float-label">
    <input pInputText id="newEnvironmentVariableValue" [(ngModel)]="value" name="newEnvironmentVariableValue">
    <label for="newEnvironmentVariableKey">Value</label>
  </div>

  <div *ngIf="type === 'Secret'">
    <div class="p-field p-float-label">
      <p-dropdown [options]="secrets" [(ngModel)]="secret" optionLabel="name"
                  [showClear]="true" name="environmentVariableSecret"
                  [autoDisplayFirst]="false"></p-dropdown>
      <label>Select secret</label>
    </div>

    <div *ngIf="secret" class="p-field p-float-label">
      <p-dropdown [options]="secret.data | keyvalue" [(ngModel)]="secretKey" optionLabel="key"
                  [showClear]="true" name="environmentVariableSecretKey"
                  [autoDisplayFirst]="false"></p-dropdown>
      <label>Select secret key</label>
    </div>
  </div>

  <button pButton pRipple icon="pi pi-plus" class="p-button-rounded p-button-plain" (click)="addEnvironmentVariable()"></button>

  <div class="p-field p-mt-2">
    <p-table #dt [value]="environmentVariables" dataKey="id"
             styleClass="p-datatable-environmentVariables p-datatable-striped p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>Variable</th>
          <th>Value</th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-environmentVariable let-i="rowIndex">
        <tr>
          <td>
            <span class="p-column-title">Variable</span>{{environmentVariable.key}}
          </td>
          <td>
            <span class="p-column-title">Value</span>
            {{environmentVariable.type === 'Value' ? environmentVariable.value : environmentVariable.secretName + ':' + environmentVariable.secretKey}}
          </td>
          <td>
            <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning" (click)="removeEnvironmentVariable(environmentVariable)"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
